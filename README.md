# Tourist Accommodations Map

An interactive web application that visualizes tourist accommodation data by census section in Spain, using data from the Spanish National Statistics Institute (INE).

## Project Overview

This application provides a visual representation of tourist accommodation distribution across Spain, showing the density of tourism accommodations by census section. Users can filter the data by province, municipality, and accommodation count ranges.

## Directory Structure

- `data/` - Contains input data files and processed output
  - `input/` - Place raw data files here (see README in that directory)
  - `output/` - Contains processed GeoJSON files (generated by scripts)
- `data-processing/` - Data processing scripts and utilities
  - `scripts/` - Python scripts for data processing
- `webapp/` - The web application
  - `src/` - Source code files
  - `dist/` - Compiled application (generated)

## Required Software

- [Node.js](https://nodejs.org/) (for the web application)
- [Python](https://www.python.org/) 3.8 or higher (for data processing)
- [UV](https://github.com/astral-sh/uv) - Fast Python package installer and resolver

## Getting Started

### 1. Clone the Repository

```bash
git clone https://github.com/yourusername/tourist-accommodations-map.git
cd tourist-accommodations-map
```

### 2. Install UV (if not already installed)

```bash
pip install uv
```

### 3. Set Up the Python Environment

```bash
uv venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
uv pip install -r requirements.txt
```

### 4. Download Required Data

Follow the instructions in `data/input/README.md` to download the necessary data files from the Spanish National Statistics Institute (INE).

### 5. Process the Data

```bash
uv run data-processing/scripts/convert_excel_to_csv.py
uv run data-processing/scripts/merge_shapes_with_csv.py
```

### 6. Build and Run the Web Application

```bash
cd webapp
npm install
npm run build
npm run preview
```

The application should now be available at http://localhost:3000/

## Cloudflare R2 Integration (Optional)

For production deployments, we recommend storing the GeoJSON data in Cloudflare R2 instead of including it in the repository. This allows for:

1. Handling large GeoJSON files that exceed Git's file size limits
2. Better performance when serving large files
3. Separation of code and data concerns

### Setting Up R2 Integration

1. Create a Cloudflare R2 bucket in your Cloudflare dashboard
2. Generate R2 API tokens with appropriate permissions
3. Run the setup script:

```bash
./setup_r2.sh
```

4. Edit the `.env` file with your Cloudflare R2 credentials:

```
R2_ENDPOINT=https://<account_id>.r2.cloudflarestorage.com
R2_ACCESS_KEY_ID=<your_access_key_id>
R2_SECRET_ACCESS_KEY=<your_secret_access_key>
R2_BUCKET_NAME=<your_bucket_name>
R2_PUBLIC_URL=<public_url_to_access_files>
```

5. Process and upload the data:

```bash
cd data-processing/scripts
uv run merge_shapes_with_csv.py
```

The script will:
- Generate the GeoJSON file locally
- Upload it to Cloudflare R2
- Create a configuration file with the R2 URL
- The web application will automatically use the R2 URL when available

## Important Note About Running Python Scripts

Always use `uv` to run Python scripts in this project for faster execution and better dependency management:

```bash
uv run path/to/script.py
```

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Data Sources

- Census sections (Secciones Censales): [INE - Spanish National Statistics Institute](https://www.ine.es/ss/Satellite?L=es_ES&c=Page&cid=1259952026632&p=1259952026632&pagename=ProductosYServicios%2FPYSLayout#)
- Tourist accommodation data: [INE - Experimental Statistics](https://www.ine.es/experimental/viv_turistica/exp_viv_turistica_tablas.htm) 